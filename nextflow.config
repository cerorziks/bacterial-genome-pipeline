/*
========================================================================================
    Bacterial Genome Analysis Pipeline - Configuration
========================================================================================
*/

// Global default params
params {
    // Input/Output options
    input                  = null
    outdir                 = './results'
    
    // Reference and database options
    reference              = null
    organism               = null  // Organism for AMRFinder point mutations (e.g., 'Escherichia')
    
    // Database Options (Input: if provided, skips download)
    kraken_db              = null
    amr_db                 = null
    vfdb                   = null
    
    // Database Cache (Output: where downloads are stored)
    db_cache               = "${launchDir}/databases"
    
    // Skip options
    skip_phylogeny         = false
    skip_mlst              = false
    skip_pangenomics       = false
    
    // Help
    help                   = false
    
    // Quality control parameters
    fastp_qualified_quality_phred = 20
    fastp_min_length       = 50
    
    // Assembly parameters
    assembler              = 'shovill'
    spades_kmers           = 'auto'
    
    // MultiQC options
    multiqc_title          = 'Bacterial Genome Analysis Report'
    
    // Resource defaults
    max_cpus               = 4
    max_memory             = '8.GB'
    max_time               = '240.h'
}

// Load base configuration
includeConfig 'conf/base.config'

// Container configuration
includeConfig 'conf/containers.config'

// Process configuration
process {
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Container options
    container = null  // Set in containers.config
}

// Execution profiles
profiles {
    
    docker {
        docker.enabled         = true
        docker.runOptions      = '-u $(id -u):$(id -g)'
        singularity.enabled    = false
        conda.enabled          = false
    }
    
    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        docker.enabled         = false
        conda.enabled          = false
    }
    
    local {
        docker.enabled         = false
        singularity.enabled    = false
        conda.enabled          = false
    }
    
    test {
        params.max_cpus   = 2
        params.max_memory = '6.GB'
        params.max_time   = '6.h'
    }
    
    // Cluster profiles can be added here
    slurm {
        process.executor = 'slurm'
        process.queue = 'batch'
    }
}

// Pipeline metadata
manifest {
    name            = 'Bacterial-Genome-Pipeline'
    author          = 'Nextflow Pipeline'
    homePage        = ''
    description     = 'Comprehensive bacterial genome analysis pipeline'
    mainScript      = 'main.nf'
    nextflowVersion = '!>=22.10.0'
    version         = '1.1.0' // Polished Version
}

// Execution reporting
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_timeline.html"
}

report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_report.html"
}

trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_trace.txt"
}

dag {
    enabled = true
    file    = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}
